<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>parallax.main_window_wip &mdash; Parallax 0.37.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=f5ec9bd4"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Parallax
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Parallax</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../parallax.html">parallax</a></li>
      <li class="breadcrumb-item active">parallax.main_window_wip</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for parallax.main_window_wip</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This script defines the main components of the application including the main window, UI elements,</span>
<span class="sd">camera and stage management, and recording functionality.</span>

<span class="sd">Modules imported:</span>
<span class="sd">- PyQt5 modules for building the graphical user interface.</span>
<span class="sd">- Other libraries and modules necessary for the application&#39;s functionality.</span>

<span class="sd">Classes:</span>
<span class="sd">- MainWindow: Represents the main window of the application.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Import required PyQt5 modules and other libraries</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QFileDialog</span><span class="p">,</span> <span class="n">QScrollArea</span><span class="p">,</span> <span class="n">QSplitter</span><span class="p">,</span> <span class="n">QGridLayout</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QGroupBox</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QToolButton</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">QCoreApplication</span><span class="p">,</span> <span class="n">QStandardPaths</span><span class="p">,</span> <span class="n">QTimer</span><span class="p">,</span> <span class="n">QPoint</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QFont</span><span class="p">,</span> <span class="n">QFontDatabase</span>
<span class="kn">from</span> <span class="nn">PyQt5.uic</span> <span class="kn">import</span> <span class="n">loadUi</span>
<span class="kn">from</span> <span class="nn">.screen_widget</span> <span class="kn">import</span> <span class="n">ScreenWidget</span>
<span class="kn">from</span> <span class="nn">.recording_manager</span> <span class="kn">import</span> <span class="n">RecordingManager</span>
<span class="kn">from</span> <span class="nn">.stage_widget</span> <span class="kn">import</span> <span class="n">StageWidget</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ui_dir</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># Set logger name</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="c1"># Set the logging level for PyQt5.uic.uiparser/properties to WARNING, to ignore DEBUG messages</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;PyQt5.uic.uiparser&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;PyQt5.uic.properties&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># User Preferences (Data directory, UI config..) setting file</span>
<span class="n">SETTINGS_FILE</span> <span class="o">=</span> <span class="s1">&#39;settings.json&#39;</span>

<span class="c1"># Main application window</span>
<div class="viewcode-block" id="MainWindow"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow">[docs]</a><span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The main window of the application.</span>
<span class="sd">    </span>
<span class="sd">    This class represents the main window of the application and handles the user interface</span>
<span class="sd">    components, camera and stage management, and recording functionality.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">dummy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">QMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c1"># Initialize the QMainWindow</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the MainWindow.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            model (object): The data model for the application.</span>
<span class="sd">            dummy (bool, optional): Flag indicating whether to run in dummy mode. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dummy</span> <span class="o">=</span> <span class="n">dummy</span>
        <span class="c1"># self.model.clean() TBD call to close the camera when there was abnormal program exit in previous run.</span>

        <span class="c1"># Initialize an empty list to keep track of microscopeGrp widgets instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_widgets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recording_camera_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Update camera information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_cameras</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nPySpinCameras: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span><span class="si">}</span><span class="s2">, nMockCameras: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nMockCameras</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
        <span class="c1"># Update stage information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_stages</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stages: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Load column configuration from user preferences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nColumn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_settings_item</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="s2">&quot;nColumn&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nColumn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nColumn</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nColumn</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nColumn</span><span class="p">)</span>

        <span class="c1"># Load the main widget with UI components</span>
        <span class="n">ui</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ui_dir</span><span class="p">,</span> <span class="s2">&quot;mainWindow.ui&quot;</span><span class="p">)</span>
        <span class="n">loadUi</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Load Fira Code font</span>
        <span class="n">fira_code_font_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ui_dir</span><span class="p">,</span> <span class="s2">&quot;font/FiraCode-VariableFont_wght.ttf&quot;</span><span class="p">)</span>
        <span class="n">QFontDatabase</span><span class="o">.</span><span class="n">addApplicationFont</span><span class="p">(</span><span class="n">fira_code_font_path</span><span class="p">)</span>
        <span class="n">fira_code_font</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Fira Code Light&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c1"># Setting font size to 10</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">fira_code_font</span><span class="p">)</span>

        <span class="c1"># Load existing user preferences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_mainWindow_settings</span><span class="p">()</span>

        <span class="c1"># Attach directory selection event handler for saving files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browseDirButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir_setting_handler</span><span class="p">)</span>

        <span class="c1"># Configure the column spin box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nColumnsSpinBox</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nColumnsSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nColumn</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nColumnsSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_changed_handler</span><span class="p">)</span>

        <span class="c1"># Refreshing the settingMenu while it is toggled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings_refresh_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">()</span>

        <span class="c1"># Create the widget for screen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollArea</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollArea</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollArea</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;scrollArea&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollAreaWidgetContents</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollAreaWidgetContents</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;scrollAreaWidgetContents&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scrollAreaWidgetContents</span><span class="p">)</span>

        <span class="c1"># Dynamically generate Microscope display</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_microscope</span><span class="p">()</span> <span class="c1"># Attach screen widget</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Display only mock camera</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_mock_camera</span><span class="p">()</span>

        <span class="c1"># Stage_widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_widget</span> <span class="o">=</span> <span class="n">StageWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">ui_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_widgets</span><span class="p">)</span>
        <span class="n">splitter</span> <span class="o">=</span> <span class="n">QSplitter</span><span class="p">()</span>
        <span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scrollAreaWidgetContents</span><span class="p">)</span>
        <span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout_4</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">splitter</span><span class="p">)</span>

        <span class="c1"># Start button. If toggled, start camera acquisition  </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_button_handler</span><span class="p">)</span>
        
        <span class="c1"># Recording functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recordingManager</span> <span class="o">=</span> <span class="n">RecordingManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshotButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">recordingManager</span><span class="o">.</span><span class="n">save_last_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirLabel</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_widgets</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recordButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">record_button_handler</span><span class="p">)</span>       <span class="c1"># Recording video button</span>

        <span class="c1"># Refreshing the screen timer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">)</span>

        <span class="c1"># Toggle start button on init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_button_handler</span><span class="p">()</span>
    
<div class="viewcode-block" id="MainWindow.refresh_cameras"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.refresh_cameras">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_cameras</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is responsible for scanning for available cameras and updating the camera list.</span>
<span class="sd">        It adds mock cameras for testing purposes and scans for actual cameras if the application</span>
<span class="sd">        is not in dummy mode. This ensures that the list of available cameras is always up-to-date.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add mock cameras for testing purposes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_mock_cameras</span><span class="p">()</span>
        <span class="c1"># If not in dummy mode, scan for actual available cameras</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dummy</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">scan_for_cameras</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Something still holds a reference to the camera.</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.refresh_stages"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.refresh_stages">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_stages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Search for connected stages &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dummy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">scan_for_usb_stages</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindow.record_button_handler"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.record_button_handler">[docs]</a>    <span class="k">def</span> <span class="nf">record_button_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the record button press event.</span>
<span class="sd">        If the record button is checked, start recording. Otherwise, stop recording.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recordButton</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirLabel</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">recordingManager</span><span class="o">.</span><span class="n">save_recording</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_widgets</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recordingManager</span><span class="o">.</span><span class="n">stop_recording</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen_widgets</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="MainWindow.start_button_handler"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.start_button_handler">[docs]</a>    <span class="k">def</span> <span class="nf">start_button_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the start button press event.</span>
<span class="sd">        </span>
<span class="sd">        If the start button is checked, initiate acquisition from all cameras and start refreshing images.</span>
<span class="sd">        If unchecked, stop acquisition from all cameras and stop refreshing images.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize the list to keep track of cameras that have been started or stopped</span>
        <span class="n">refresh_camera_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Check if the start button is toggled on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">startButton</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Refreshing Screen&quot;</span><span class="p">)</span>
            <span class="c1"># Camera begin acquisition</span>
            <span class="k">for</span> <span class="n">screen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_widgets</span><span class="p">:</span>
                <span class="n">camera_name</span> <span class="o">=</span> <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_name</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">camera_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">refresh_camera_list</span><span class="p">:</span>
                    <span class="n">screen</span><span class="o">.</span><span class="n">start_acquisition_camera</span><span class="p">()</span>
                    <span class="n">refresh_camera_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">camera_name</span><span class="p">)</span>
            
            <span class="c1"># Refreshing images to display screen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">125</span><span class="p">)</span>

            <span class="c1"># Start button is checked, enable record and snapshot button. </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recordButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapshotButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stop Refreshing Screen&quot;</span><span class="p">)</span>
            <span class="c1"># Start button is unchecked, disable record and snapshot button. </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recordButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recordButton</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">snapshotButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="c1"># Stop Refresh: stop refreshing images to display screen</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_timer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refresh_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

            <span class="c1"># End acquisition from camera: stop acquiring images from camera to framebuffer</span>
            <span class="k">for</span> <span class="n">screen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_widgets</span><span class="p">:</span>
                <span class="n">camera_name</span> <span class="o">=</span> <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_name</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">camera_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">refresh_camera_list</span><span class="p">:</span>
                    <span class="n">screen</span><span class="o">.</span><span class="n">stop_acquisition_camera</span><span class="p">()</span>
                    <span class="n">refresh_camera_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">camera_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.refresh"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Refreshing from framebuffer to screen&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">screen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_widgets</span><span class="p">:</span>
            <span class="n">screen</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>        <span class="c1"># Refresh the screens</span></div>
        
<div class="viewcode-block" id="MainWindow.display_mock_camera"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.display_mock_camera">[docs]</a>    <span class="k">def</span> <span class="nf">display_mock_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display mock camera when there is no detected camera.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createNewGroupBox</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mock</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.display_microscope"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.display_microscope">[docs]</a>    <span class="k">def</span> <span class="nf">display_microscope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamically arrange Microscopes based on camera count and column configuration.&quot;&quot;&quot;</span>
        <span class="c1"># Calculate rows and columns</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">nColumn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nColumn</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">rows</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span> <span class="o">%</span> <span class="n">cols</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="c1"># Create grid of Microscope displays</span>
        <span class="k">for</span> <span class="n">row_idx</span>  <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col_idx</span>  <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">createNewGroupBox</span><span class="p">(</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">,</span> <span class="n">screen_index</span><span class="o">=</span><span class="n">cnt</span><span class="p">)</span>
                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span> <span class="c1"># Stop when all Microscopes are displayed</span></div>

<div class="viewcode-block" id="MainWindow.column_changed_handler"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.column_changed_handler">[docs]</a>    <span class="k">def</span> <span class="nf">column_changed_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rearrange the layout of Microscopes when the column number changes.&quot;&quot;&quot;</span>
        <span class="c1"># Identify current Microscope widgets</span>
        <span class="n">camera_screen_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Detach the identified widgets</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">QGroupBox</span><span class="p">):</span>  <span class="c1"># Ensure we&#39;re handling the correct type of widget</span>
                <span class="n">camera_screen_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="c1"># Detach the identified widgets</span>
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">camera_screen_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span> <span class="c1"># Temporarily hide the widget</span>

        <span class="c1"># Calculate new rows and columns layout</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span><span class="o">//</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">rows</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nPySpinCameras</span> <span class="o">%</span> <span class="n">cols</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Reattach widgets in the new layout</span>
        <span class="k">for</span> <span class="n">row_idx</span>  <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col_idx</span>  <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">camera_screen_list</span><span class="p">):</span> 
                    <span class="n">widget</span> <span class="o">=</span> <span class="n">camera_screen_list</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">widget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Make the widget visible again</span>
                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span></div>

<div class="viewcode-block" id="MainWindow.createNewGroupBox"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.createNewGroupBox">[docs]</a>    <span class="k">def</span> <span class="nf">createNewGroupBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">mock</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">screen_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new group box widget representing a microscope, and add it to the grid layout.</span>
<span class="sd">        This function is responsible for generating a unique name for the microscope, creating a group box to</span>
<span class="sd">        represent it, adding a screen widget for camera display, a settings button, and configuring their</span>
<span class="sd">        properties and layouts. It also adds the group box to the grid layout at the specified row and column</span>
<span class="sd">        indices, and updates the settings menu for the microscope.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - rows (int): The row index in the grid layout where the group box should be added.</span>
<span class="sd">        - cols (int): The column index in the grid layout where the group box should be added.</span>
<span class="sd">        - mock (bool, optional): If True, a mock camera will be associated with this microscope. Default is False.</span>
<span class="sd">        - screen_index (int, optional): The index of the camera in the model&#39;s camera list to be associated</span>
<span class="sd">        with this microscope. Required if mock is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generate unique names based on row and column indices</span>
        <span class="n">newNameMicroscope</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># Generate unique names based on camera number</span>
        <span class="k">if</span> <span class="n">mock</span><span class="p">:</span>
            <span class="n">newNameMicroscope</span> <span class="o">=</span> <span class="s2">&quot;Mock Camera&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newNameMicroscope</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Microscope_</span><span class="si">{</span><span class="n">screen_index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">microscopeGrp</span> <span class="o">=</span> <span class="n">QGroupBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scrollAreaWidgetContents</span><span class="p">)</span>
       
        <span class="c1"># Construct and configure the Microscope widget</span>
        <span class="n">microscopeGrp</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">newNameMicroscope</span><span class="p">)</span>
        <span class="n">microscopeGrp</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;background-color: rgb(58, 58, 58);&quot;</span><span class="p">)</span>
        <span class="n">font_grpbox</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">()</span>
        <span class="n">font_grpbox</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>  <span class="c1"># Setting font size to 9</span>
        <span class="n">microscopeGrp</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font_grpbox</span><span class="p">)</span>
        <span class="n">verticalLayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">)</span>
        <span class="n">verticalLayout</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;verticalLayout&quot;</span><span class="p">)</span>
        
        <span class="c1"># Add screens</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="n">ScreenWidget</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">microscopeGrp</span><span class="p">)</span>
        <span class="n">screen</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Screen&quot;</span><span class="p">)</span>
        <span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">screen</span><span class="p">)</span>
        
        <span class="c1"># Add camera on screen</span>
        <span class="k">if</span> <span class="n">mock</span><span class="p">:</span> 
            <span class="n">screen</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">screen</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">screen_index</span><span class="p">])</span> <span class="c1"># set screen.camera = model.camera </span>

        <span class="c1"># Add setting button</span>
        <span class="n">settingButton</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">)</span>
        <span class="n">settingButton</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting&quot;</span><span class="p">)</span>
        <span class="n">settingButton</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font_grpbox</span><span class="p">)</span>
        <span class="n">settingButton</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_settings_menu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> <span class="n">newNameMicroscope</span><span class="p">,</span> <span class="n">screen</span><span class="p">,</span> <span class="n">screen_index</span><span class="p">)</span>
        <span class="n">settingButton</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">checked</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_settings_menu</span><span class="p">(</span><span class="n">settingButton</span><span class="p">,</span> <span class="n">checked</span><span class="p">))</span>
        <span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">settingButton</span><span class="p">)</span>
        
        <span class="c1"># Add widget to the gridlayout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">settingButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;MainWindow&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;SETTINGS </span><span class="se">\u25ba</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
       
        <span class="c1"># Load setting file from JSON</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_setting_menu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">)</span>

        <span class="c1"># Add the new microscopeGrpBox instance to the list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">screen</span><span class="p">)</span> </div>

<div class="viewcode-block" id="MainWindow.create_settings_menu"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.create_settings_menu">[docs]</a>    <span class="k">def</span> <span class="nf">create_settings_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">microscopeGrp</span><span class="p">,</span> <span class="n">newNameMicroscope</span><span class="p">,</span> <span class="n">screen</span><span class="p">,</span> <span class="n">screen_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the settings menu for each Microscope widget.</span>

<span class="sd">        This function initializes the settings menu UI, loads it with necessary data, </span>
<span class="sd">        and associates the relevant signals with their slots. </span>
<span class="sd">        The settings menu is hidden by default and will be shown </span>
<span class="sd">        when the user toggles the settings button.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - microscopeGrp (QGroupBox): The group box representing a Microscope widget.</span>
<span class="sd">        - newNameMicroscope (str): The unique name assigned to the Microscope widget.</span>
<span class="sd">        - screen (ScreenWidget): The screen widget associated with the Microscope.</span>
<span class="sd">        - screen_index (int): The index of the camera in the model&#39;s camera list to be associated with this screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize the settings menu UI from the .ui file</span>
        <span class="n">settingMenu</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">)</span>
        <span class="n">setting_ui</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ui_dir</span><span class="p">,</span> <span class="s2">&quot;settingPopUpMenu.ui&quot;</span><span class="p">)</span>
        <span class="n">loadUi</span><span class="p">(</span><span class="n">setting_ui</span><span class="p">,</span> <span class="n">settingMenu</span><span class="p">)</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;SettingsMenu&quot;</span><span class="p">)</span>        
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>  <span class="c1"># Hide the menu by default</span>
        
        <span class="c1"># S/N</span>
        <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cameras_sn</span><span class="p">:</span>        <span class="c1"># Add the list of cameras (serial number) in ComboBox</span>
            <span class="n">settingMenu</span><span class="o">.</span><span class="n">snComboBox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span> 
        <span class="n">sn</span> <span class="o">=</span> <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_name</span><span class="p">()</span>           <span class="c1"># Select the sn for the current screen</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">snComboBox</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">settingMenu</span><span class="o">.</span><span class="n">snComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;SN not found in the list&quot;</span><span class="p">)</span>

        <span class="c1"># If serial number is changed, connect to update_screen function and update setting menu</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">snComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_screen</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> \
                                             <span class="n">screen_index</span><span class="p">,</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">snComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()))</span>
        
        <span class="c1"># Custom name</span>
        <span class="n">customName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_settings_item</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="s2">&quot;customName&quot;</span><span class="p">)</span>  <span class="c1"># Default name on init</span>
        <span class="n">customName</span> <span class="o">=</span> <span class="n">customName</span> <span class="k">if</span> <span class="n">customName</span> <span class="k">else</span> <span class="n">newNameMicroscope</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">customName</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">customName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_groupbox_name</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> <span class="n">customName</span><span class="p">)</span>    <span class="c1"># Update GroupBox name</span>
        <span class="c1"># Name) If custom name is changed, change the groupBox name. </span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">customName</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_groupbox_name</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> \
                                                                            <span class="n">settingMenu</span><span class="o">.</span><span class="n">customName</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">customName</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_configs_settingMenu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> \
                                                            <span class="s2">&quot;customName&quot;</span><span class="p">,</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">customName</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
        
        <span class="c1"># Exposure</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">expSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">screen</span><span class="o">.</span><span class="n">set_camera_setting</span><span class="p">(</span><span class="n">setting</span> <span class="o">=</span> <span class="s2">&quot;exposure&quot;</span><span class="p">,</span>\
                                                                <span class="n">val</span> <span class="o">=</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">expSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">expSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">expNum</span><span class="o">.</span><span class="n">setNum</span><span class="p">(</span><span class="n">settingMenu</span><span class="o">.</span><span class="n">expSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">expSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_configs_settingMenu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> \
                            <span class="s2">&quot;exp&quot;</span><span class="p">,</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">expSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>       
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">expAuto</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">expSlider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span>\
                            <span class="nb">int</span><span class="p">(</span><span class="n">screen</span><span class="o">.</span><span class="n">get_camera_setting</span><span class="p">(</span><span class="n">setting</span> <span class="o">=</span> <span class="s2">&quot;exposure&quot;</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">)))</span>

        <span class="c1"># Gain</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">gainSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">screen</span><span class="o">.</span><span class="n">set_camera_setting</span><span class="p">(</span><span class="n">setting</span> <span class="o">=</span> <span class="s2">&quot;gain&quot;</span><span class="p">,</span>\
                                                                <span class="n">val</span> <span class="o">=</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">gainSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">gainSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">gainNum</span><span class="o">.</span><span class="n">setNum</span><span class="p">(</span><span class="n">settingMenu</span><span class="o">.</span><span class="n">gainSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">gainSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_configs_settingMenu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> \
                            <span class="s2">&quot;gain&quot;</span><span class="p">,</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">gainSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">gainAuto</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">gainSlider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span>\
                            <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_setting</span><span class="p">(</span><span class="n">setting</span> <span class="o">=</span> <span class="s2">&quot;gain&quot;</span><span class="p">)))</span>

        <span class="c1"># Gamma</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">screen</span><span class="o">.</span><span class="n">set_camera_setting</span><span class="p">(</span><span class="n">setting</span> <span class="o">=</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span>\
                                                                <span class="n">val</span> <span class="o">=</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaNum</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span><span class="p">)))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_configs_settingMenu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> \
                            <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaAuto</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span>
                            <span class="ow">not</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">()))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaAuto</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_configs_settingMenu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> <span class="s2">&quot;gammaAuto&quot;</span><span class="p">,</span> \
                            <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">()))</span>
                            
        <span class="c1"># W/B</span>
        <span class="n">settingLayout</span> <span class="o">=</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
        <span class="n">settingLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">settingMenu</span><span class="o">.</span><span class="n">wbAuto</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Blue Channel</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderBlue</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">screen</span><span class="o">.</span><span class="n">set_camera_setting</span><span class="p">(</span><span class="n">setting</span> <span class="o">=</span> <span class="s2">&quot;wbBlue&quot;</span><span class="p">,</span>\
                                                                <span class="n">val</span> <span class="o">=</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderBlue</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderBlue</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbNumBlue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>\
                        <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderBlue</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span><span class="p">)))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderBlue</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_configs_settingMenu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> \
                        <span class="s2">&quot;wbBlue&quot;</span><span class="p">,</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderBlue</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbAuto</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderBlue</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span>\
                        <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_setting</span><span class="p">(</span><span class="n">setting</span> <span class="o">=</span> <span class="s2">&quot;wbBlue&quot;</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
        
        <span class="c1"># Red Channel</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderRed</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">screen</span><span class="o">.</span><span class="n">set_camera_setting</span><span class="p">(</span><span class="n">setting</span> <span class="o">=</span> <span class="s2">&quot;wbRed&quot;</span><span class="p">,</span>\
                                                                <span class="n">val</span> <span class="o">=</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderRed</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderRed</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbNumRed</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>\
                        <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderRed</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">/</span><span class="mi">100</span><span class="p">)))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderRed</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user_configs_settingMenu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> \
                        <span class="s2">&quot;wbRed&quot;</span><span class="p">,</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderRed</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>
        <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbAuto</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderRed</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span>\
                        <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_setting</span><span class="p">(</span><span class="n">setting</span> <span class="o">=</span> <span class="s2">&quot;wbRed&quot;</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="MainWindow.update_screen"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.update_screen">[docs]</a>    <span class="k">def</span> <span class="nf">update_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">screen</span><span class="p">,</span> <span class="n">screen_index</span><span class="p">,</span> <span class="n">selected_sn</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the screen with a new camera based on the selected serial number.</span>

<span class="sd">        This method manages the update of the camera associated with a specific microscope screen. It takes into</span>
<span class="sd">        account the current state of the application, i.e., whether acquisition is ongoing or not, and performs</span>
<span class="sd">        the necessary actions to update the camera and manage acquisition accordingly.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - screen (ScreenWidget): The screen widget associated with the microscope.</span>
<span class="sd">        - screen_index (int): The index of the screen in the list of all microscope screens.</span>
<span class="sd">        - selected_sn (str): The serial number of the camera selected to be associated with the microscope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Camera lists that currently attached on the model.</span>
        <span class="n">camera_list</span> <span class="o">=</span> <span class="p">{</span><span class="n">camera</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">sn_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> <span class="n">camera</span> <span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cameras</span><span class="p">}</span>

        <span class="c1"># Get the prev camera lists displaying on the screen</span>
        <span class="n">prev_camera</span><span class="p">,</span> <span class="n">curr_camera</span> <span class="o">=</span> <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_name</span><span class="p">(),</span> <span class="n">selected_sn</span>
        <span class="n">prev_lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">screen</span><span class="o">.</span><span class="n">get_camera_name</span><span class="p">()</span> <span class="k">for</span> <span class="n">screen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_widgets</span> <span class="k">if</span> <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_name</span><span class="p">()]</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">screen_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev_lists</span><span class="p">):</span>  <span class="c1"># Ensure screen_index is within valid range</span>
            <span class="n">curr_list</span> <span class="o">=</span> <span class="n">prev_lists</span><span class="p">[:]</span>
            <span class="n">curr_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">screen_index</span><span class="p">)</span>
            <span class="n">curr_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">screen_index</span><span class="p">,</span> <span class="n">curr_camera</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid screen index: </span><span class="si">{</span><span class="n">screen_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;prev_list: </span><span class="si">{</span><span class="n">prev_lists</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;curr_list: </span><span class="si">{</span><span class="n">curr_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Handle updates based on the current state of the application</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">startButton</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>        <span class="c1"># If the &#39;Start&#39; button is enabled (continuous acquisition mode)</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">prev_lists</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">curr_list</span><span class="p">):</span>
                <span class="c1"># If the list of cameras hasn&#39;t changed, just update the current screen&#39;s camera</span>
                <span class="n">screen</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">camera_list</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_camera</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prev_camera</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_list</span><span class="p">:</span>
                    <span class="c1"># If the previous camera has been removed from the list, stop its acquisition</span>
                    <span class="n">screen</span><span class="o">.</span><span class="n">stop_acquisition_camera</span><span class="p">()</span>
                    <span class="n">screen</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">camera_list</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_camera</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">curr_camera</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prev_lists</span><span class="p">:</span>
                    <span class="c1"># If the selected camera is new (wasn&#39;t in the previous list), start its acquisition</span>
                    <span class="n">screen</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">camera_list</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_camera</span><span class="p">))</span>
                    <span class="n">screen</span><span class="o">.</span><span class="n">start_acquisition_camera</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the &#39;Start&#39; button is disabled, start single frame acquisition to show the image</span>
            <span class="n">screen</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">camera_list</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_camera</span><span class="p">))</span>
            <span class="n">screen</span><span class="o">.</span><span class="n">single_acquisition_camera</span><span class="p">()</span>
            <span class="n">screen</span><span class="o">.</span><span class="n">refresh_single_frame</span><span class="p">()</span>
            <span class="n">screen</span><span class="o">.</span><span class="n">stop_single_acquisition_camera</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindow.update_groupbox_name"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.update_groupbox_name">[docs]</a>    <span class="k">def</span> <span class="nf">update_groupbox_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">microscopeGrp</span><span class="p">,</span> <span class="n">customName</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the title and object name of the group box representing a microscope.</span>

<span class="sd">        This method is used to update the visual representation of a microscope based on a custom name provided</span>
<span class="sd">        by the user.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - microscopeGrp (QGroupBox): The group box representing the microscope.</span>
<span class="sd">        - customName (str): The custom name to set as the title and object name of the group box.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">customName</span><span class="p">:</span> 
            <span class="n">microscopeGrp</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="n">customName</span><span class="p">)</span>
            <span class="n">microscopeGrp</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">customName</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.show_settings_menu"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.show_settings_menu">[docs]</a>    <span class="k">def</span> <span class="nf">show_settings_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settingButton</span><span class="p">,</span> <span class="n">is_checked</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show or hide the settings menu associated with a microscope group box.</span>

<span class="sd">        This method is connected to the toggled signal of a QToolButton, which represents</span>
<span class="sd">        the settings button for a microscope group box. When the button is toggled, it</span>
<span class="sd">        shows or hides the settings menu and starts or stops a timer to refresh the settings</span>
<span class="sd">        values displayed in the menu.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - settingButton (QToolButton): The settings button associated with the microscope group box.</span>
<span class="sd">        - is_checked (bool): Indicates whether the settings button is checked (True) or unchecked (False).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">microscopeGrp</span> <span class="o">=</span> <span class="n">settingButton</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="c1"># Find the settingMenu within this microscopeGrp</span>
        <span class="n">settingMenu</span> <span class="o">=</span> <span class="n">microscopeGrp</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">QWidget</span><span class="p">,</span> <span class="s2">&quot;SettingsMenu&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings_refresh_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_setting_menu</span><span class="p">,</span> <span class="n">microscopeGrp</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">is_checked</span><span class="p">:</span>
            <span class="c1"># If the settings button is checked, start the settings refresh timer and show the settings menu</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings_refresh_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>      <span class="c1"># update setting menu every 0.1 sec</span>
            
            <span class="c1"># Show the setting menu next to setting button</span>
            <span class="n">button_position</span> <span class="o">=</span> <span class="n">settingButton</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">settingButton</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
            <span class="n">menu_x</span> <span class="o">=</span> <span class="n">button_position</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">settingButton</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
            <span class="n">menu_x</span> <span class="o">=</span> <span class="n">menu_x</span> <span class="o">-</span> <span class="n">microscopeGrp</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">QPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
            <span class="n">menu_y</span> <span class="o">=</span> <span class="n">settingButton</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="n">settingButton</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">-</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(SettingMenu) coordinates of setting menu: x: </span><span class="si">{</span><span class="n">menu_x</span><span class="si">}</span><span class="s2">, y: </span><span class="si">{</span><span class="n">menu_y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">settingMenu</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">menu_x</span><span class="p">,</span> <span class="n">menu_y</span><span class="p">)</span>
            <span class="n">settingMenu</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the settings button is unchecked, stop the settings refresh timer and hide the settings menu</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings_refresh_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="n">settingMenu</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>

<div class="viewcode-block" id="MainWindow.update_setting_menu"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.update_setting_menu">[docs]</a>    <span class="k">def</span> <span class="nf">update_setting_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">microscopeGrp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the values displayed in the settings menu based on the current camera settings.</span>

<span class="sd">        This method is called periodically by a QTimer to refresh the values displayed in the</span>
<span class="sd">        settings menu, ensuring they are up-to-date with the current settings of the camera.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - microscopeGrp (QGroupBox): The microscope group box associated with the settings menu to be updated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Find the settingMenu within this microscopeGrp</span>
        <span class="n">settingMenu</span> <span class="o">=</span> <span class="n">microscopeGrp</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">QWidget</span><span class="p">,</span> <span class="s2">&quot;SettingsMenu&quot;</span><span class="p">)</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="n">microscopeGrp</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">ScreenWidget</span><span class="p">,</span> <span class="s2">&quot;Screen&quot;</span><span class="p">)</span>

        <span class="c1"># Display the S/N of camera </span>
        <span class="n">sn</span> <span class="o">=</span> <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_name</span><span class="p">()</span>
        <span class="c1"># Load the saved settings</span>
        <span class="n">saved_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_settings_item</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">saved_settings</span><span class="p">:</span>
            <span class="c1"># If saved settings are found, update the sliders in the settings menu with the saved values</span>
            <span class="n">settingMenu</span><span class="o">.</span><span class="n">expSlider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">saved_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
            <span class="n">settingMenu</span><span class="o">.</span><span class="n">gainSlider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">saved_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gain&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

            <span class="c1"># Gamma</span>
            <span class="n">gammaAuto</span> <span class="o">=</span> <span class="n">saved_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gammaAuto&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gammaAuto</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">saved_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">gammaAuto</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># W/B</span>
            <span class="k">if</span> <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_color_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Color&quot;</span><span class="p">:</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbAuto</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderRed</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderBlue</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderRed</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">saved_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wbRed&#39;</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderBlue</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">saved_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wbBlue&#39;</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_color_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Mono&quot;</span><span class="p">:</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbAuto</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderRed</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbSliderBlue</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbNumRed</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
                <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbNumBlue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span> 
            <span class="n">settingMenu</span><span class="o">.</span><span class="n">gainAuto</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">settingMenu</span><span class="o">.</span><span class="n">wbAuto</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">settingMenu</span><span class="o">.</span><span class="n">expAuto</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_user_configs_settingMenu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> <span class="s2">&quot;gammaAuto&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_user_configs_settingMenu</span><span class="p">(</span><span class="n">microscopeGrp</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="n">settingMenu</span><span class="o">.</span><span class="n">gammaSlider</span><span class="o">.</span><span class="n">value</span><span class="p">())</span></div>
            
<div class="viewcode-block" id="MainWindow.dir_setting_handler"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.dir_setting_handler">[docs]</a>    <span class="k">def</span> <span class="nf">dir_setting_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method handles the selection of a directory for saving files. It opens a dialog that allows</span>
<span class="sd">        the user to browse their filesystem and select a directory. The selected directory&#39;s path is then</span>
<span class="sd">        displayed on the user interface.</span>

<span class="sd">        This is a crucial function for users who need to save data or configurations, as it provides a</span>
<span class="sd">        simple and intuitive way to specify the location where files should be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Fetch the default documents directory path</span>
        <span class="n">documents_dir</span> <span class="o">=</span> <span class="n">QStandardPaths</span><span class="o">.</span><span class="n">writableLocation</span><span class="p">(</span><span class="n">QStandardPaths</span><span class="o">.</span><span class="n">DocumentsLocation</span><span class="p">)</span>
        <span class="c1"># Open a dialog to allow the user to select a directory</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Select Directory&quot;</span><span class="p">,</span> <span class="n">documents_dir</span><span class="p">)</span>
        <span class="c1"># If a directory is chosen, update the label to display the chosen path</span>
        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="MainWindow.save_user_configs"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.save_user_configs">[docs]</a>    <span class="k">def</span> <span class="nf">save_user_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method saves user configurations, such as column configuration and directory path,</span>
<span class="sd">        to a JSON file. This ensures that user preferences are preserved and can be reloaded</span>
<span class="sd">        the next time the application is started.</span>

<span class="sd">        The method reads the current settings from a file (if it exists), updates the settings</span>
<span class="sd">        with the current user configurations, and then writes the updated settings back to the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Read current settings from file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">SETTINGS_FILE</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">SETTINGS_FILE</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;nColumn&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nColumnsSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span>
            <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirLabel</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">(),</span>  
        <span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">SETTINGS_FILE</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.load_mainWindow_settings"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.load_mainWindow_settings">[docs]</a>    <span class="k">def</span> <span class="nf">load_mainWindow_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is responsible for loading the main window settings from a JSON file when the application starts.</span>
<span class="sd">        The settings include the number of columns in the main window, the directory path for saving files, and the</span>
<span class="sd">        dimensions of the main window. If the settings file does not exist, the method logs a debug message indicating</span>
<span class="sd">        that the settings file was not found.</span>

<span class="sd">        The purpose of this method is to enhance user experience by preserving user preferences across sessions, allowing</span>
<span class="sd">        the application to remember the user&#39;s settings and adjust the interface accordingly when it is restarted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">SETTINGS_FILE</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">SETTINGS_FILE</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;main&quot;</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
                    <span class="n">main_settings</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nColumnsSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">main_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nColumn&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  
                    <span class="bp">self</span><span class="o">.</span><span class="n">dirLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">main_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> 
                    <span class="n">width</span> <span class="o">=</span> <span class="n">main_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mi">1400</span><span class="p">)</span>
                    <span class="n">height</span> <span class="o">=</span> <span class="n">main_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;load_settings: Settings file not found.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MainWindow.load_settings_item"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.load_settings_item">[docs]</a>    <span class="k">def</span> <span class="nf">load_settings_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It provides a flexible way to retrieve settings, whether it be a single setting</span>
<span class="sd">        item or an entire category of settings.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        category (str): The category of settings to retrieve from the settings file.</span>
<span class="sd">        item (str, optional): The specific setting item to retrieve from the category. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">        dict or any: The requested settings. If item is None, a dictionary of the entire category is returned.</span>
<span class="sd">        If item is specified, the value of the setting item is returned. If the requested category</span>
<span class="sd">        or item is not found, None is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">SETTINGS_FILE</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">SETTINGS_FILE</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">[</span><span class="n">category</span><span class="p">]:</span>
                            <span class="k">return</span> <span class="n">settings</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;load_settings_item: Item &#39;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&#39; not found in settings.&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="kc">None</span>
                    <span class="k">return</span> <span class="n">settings</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;load_settings_item: Section &#39;</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39; not found in settings.&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;load_settings_item: Settings file not found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MainWindow.update_user_configs_settingMenu"><a class="viewcode-back" href="../../parallax.html#parallax.main_window_wip.MainWindow.update_user_configs_settingMenu">[docs]</a>    <span class="k">def</span> <span class="nf">update_user_configs_settingMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">microscopeGrp</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the user configurations in the settings menu for a specific camera.</span>

<span class="sd">        This method is used to save the user&#39;s changes to camera settings in a JSON file. The changes</span>
<span class="sd">        could be made through sliders or other input fields in the settings menu associated with</span>
<span class="sd">        a microscope group box. When a user changes a setting, this method is called to update</span>
<span class="sd">        the saved settings for the camera currently associated with the given microscope group box.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - microscopeGrp (QGroupBox): The microscope group box associated with the settings menu to be updated.</span>
<span class="sd">        - item (str): The name of the setting item to be updated (e.g., &#39;exposure&#39;, &#39;gain&#39;).</span>
<span class="sd">        - val (int/float/str): The new value of the setting item.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Find the screen within this microscopeGrp</span>
        <span class="n">screen</span> <span class="o">=</span> <span class="n">microscopeGrp</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">ScreenWidget</span><span class="p">,</span> <span class="s2">&quot;Screen&quot;</span><span class="p">)</span>

        <span class="c1"># Display the S/N of camera </span>
        <span class="n">sn</span> <span class="o">=</span> <span class="n">screen</span><span class="o">.</span><span class="n">get_camera_name</span><span class="p">()</span>

        <span class="c1"># Read current settings from file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">SETTINGS_FILE</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">SETTINGS_FILE</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Update settings with values from the settingMenu of current screen</span>
        <span class="k">if</span> <span class="n">sn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">:</span>
            <span class="n">settings</span><span class="p">[</span><span class="n">sn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">settings</span><span class="p">[</span><span class="n">sn</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="c1"># Write updated settings back to file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">SETTINGS_FILE</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></div></div>

  
        
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Hanna Lee.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>